<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GIS Trivia Challenge - Insight Global Evergreen</title>
    
    <!-- React and ReactDOM from CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .animate-bounce {
            animation: bounce 1s infinite;
        }
        
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Initialize Firebase with a demo configuration
	import { initializeApp } from "firebase/app";
	import { getAnalytics } from "firebase/analytics";
        // NOTE: Replace this with your own Firebase config for production use
        const firebaseConfig = {
          apiKey: "AIzaSyDx4EZrRUIO7fR0dSszHiDH-wfItOl-NeE",
          authDomain: "gis-trivia-game.firebaseapp.com",
          databaseURL: "https://gis-trivia-game-default-rtdb.firebaseio.com",
          projectId: "gis-trivia-game",
          storageBucket: "gis-trivia-game.firebasestorage.app",
          messagingSenderId: "518932948742",
          appId: "1:518932948742:web:3aeb4e64f66437a57b2087",
	  measurementId: "G-D128YGGB95"
        };
        
        // Initialize Firebase (with error handling for demo)
        let database;
        const app = initializeApp(firebaseConfig);
	const analytics = getAnalytics(app);
        
        // Inline SVG Icon Components
        const Trophy = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
            </svg>
        );

        const Users = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
            </svg>
        );

        const MapPin = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
        );

        const Clock = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );

        const CheckCircle = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );

        const XCircle = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );

        const Crown = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 3l4 6 3-6 3 6 4-6v13H5V3z" />
            </svg>
        );

        const Target = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10" strokeWidth={2} />
                <circle cx="12" cy="12" r="6" strokeWidth={2} />
                <circle cx="12" cy="12" r="2" strokeWidth={2} />
            </svg>
        );

        const Zap = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" />
            </svg>
        );

        const AlertTriangle = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
        );

        const AlertCircle = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );

        // Main Game Component
        const GISTriviaChallengeGame = () => {
          // Game states
          const [gameState, setGameState] = useState('lobby');
          const [playerName, setPlayerName] = useState('');
          const [playerId, setPlayerId] = useState('');
          const [isHost, setIsHost] = useState(false);
          const [roomCode, setRoomCode] = useState('');
          const [firebaseMode, setFirebaseMode] = useState(false);
          const [connectionError, setConnectionError] = useState('');
          
          // Game data (synced with Firebase)
          const [players, setPlayers] = useState([]);
          const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
          const [timeRemaining, setTimeRemaining] = useState(30);
          const [selectedAnswer, setSelectedAnswer] = useState(null);
          const [showResult, setShowResult] = useState(false);
          const [playerAnswers, setPlayerAnswers] = useState({});
          
          // Lightning round state
          const [lightningQuestionIndex, setLightningQuestionIndex] = useState(0);
          const [lightningAnswer, setLightningAnswer] = useState('');
          
          // Final Jeopardy state
          const [jeopardyWager, setJeopardyWager] = useState(0);
          const [jeopardyAnswer, setJeopardyAnswer] = useState('');
          const [showJeopardyResult, setShowJeopardyResult] = useState(false);
          const [jeopardySubmitted, setJeopardySubmitted] = useState(false);
          const [allJeopardyAnswers, setAllJeopardyAnswers] = useState({});
          
          const roomRef = useRef(null);
          const playersRef = useRef(null);
          const gameStateRef = useRef(null);

          // Questions data (same as before)
          const questions = [
            {
              difficulty: 'Easy',
              question: 'What does GIS stand for?',
              options: ['Geographic Information System', 'Global Internet Service', 'Geological Inspection Software', 'Graphical Interface System'],
              correct: 0,
              points: 100,
              penalty: -25
            },
            {
              difficulty: 'Easy',
              question: 'Which company created ArcGIS?',
              options: ['Google', 'Microsoft', 'Esri', 'Oracle'],
              correct: 2,
              points: 100,
              penalty: -25
            },
            {
              difficulty: 'Easy',
              question: 'What type of GIS data represents continuous surfaces like elevation?',
              options: ['Vector data', 'Raster data', 'Tabular data', 'Network data'],
              correct: 1,
              points: 100,
              penalty: -25
            },
            {
              difficulty: 'Easy',
              question: 'What does GPS stand for?',
              options: ['Global Positioning System', 'Geographic Projection Service', 'General Purpose Software', 'Geodetic Point System'],
              correct: 0,
              points: 100,
              penalty: -25
            },
            {
              difficulty: 'Easy',
              question: 'Which file format is commonly used for vector GIS data?',
              options: ['.jpg', '.shp', '.mp3', '.doc'],
              correct: 1,
              points: 100,
              penalty: -25
            },
            {
              difficulty: 'Easy',
              question: 'What is a feature class in GIS?',
              options: ['A type of map projection', 'A collection of geographic features with the same geometry type', 'A Python programming class', 'A map scale measurement'],
              correct: 1,
              points: 100,
              penalty: -25
            },
            {
              difficulty: 'Easy',
              question: 'Which geometry type is used to represent roads in a GIS?',
              options: ['Point', 'Line (Polyline)', 'Polygon', 'Raster'],
              correct: 1,
              points: 100,
              penalty: -25
            },
            {
              difficulty: 'Easy',
              question: 'What is the main purpose of a map legend?',
              options: ['Show the map author', 'Explain map symbols and colors', 'Display coordinates', 'Set the map scale'],
              correct: 1,
              points: 100,
              penalty: -25
            },
            {
              difficulty: 'Easy',
              question: 'Which ArcGIS product is cloud-based?',
              options: ['ArcGIS Pro', 'ArcGIS Online', 'ArcCatalog', 'ArcMap'],
              correct: 1,
              points: 100,
              penalty: -25
            },
            {
              difficulty: 'Easy',
              question: 'What does a larger map scale (e.g., 1:1,000) show compared to a smaller scale (e.g., 1:100,000)?',
              options: ['Less detail, larger area', 'More detail, smaller area', 'The same amount of detail', 'More detail, larger area'],
              correct: 1,
              points: 100,
              penalty: -25
            },
            {
              difficulty: 'Medium',
              question: 'Which spatial analysis tool creates a zone of a specified distance around features?',
              options: ['Clip', 'Union', 'Buffer', 'Dissolve'],
              correct: 2,
              points: 200,
              penalty: -50
            },
            {
              difficulty: 'Medium',
              question: 'What is the EPSG code for the WGS84 geographic coordinate system?',
              options: ['EPSG:3857', 'EPSG:4326', 'EPSG:2163', 'EPSG:3395'],
              correct: 1,
              points: 200,
              penalty: -50
            },
            {
              difficulty: 'Medium',
              question: 'Which geoprocessing tool would you use to find features that overlap between two layers?',
              options: ['Union', 'Intersect', 'Merge', 'Append'],
              correct: 1,
              points: 200,
              penalty: -50
            },
            {
              difficulty: 'Medium',
              question: 'What is a geodatabase?',
              options: ['A text file with coordinates', 'A database designed to store, query, and manage spatial and non-spatial data', 'A spreadsheet for geographic data', 'A map projection method'],
              correct: 1,
              points: 200,
              penalty: -50
            },
            {
              difficulty: 'Medium',
              question: 'Which ArcGIS tool is used for optimizing routes and finding the shortest path?',
              options: ['Spatial Join', 'Network Analyst', 'Near Tool', 'Geocoding Tool'],
              correct: 1,
              points: 200,
              penalty: -50
            },
            {
              difficulty: 'Medium',
              question: 'What does LiDAR stand for?',
              options: ['Light Detection and Ranging', 'Linear Data Recording', 'Location Information Database', 'Land Identification and Research'],
              correct: 0,
              points: 200,
              penalty: -50
            },
            {
              difficulty: 'Medium',
              question: 'Which programming language is most commonly used with ArcGIS for automation?',
              options: ['Java', 'C++', 'Python', 'Ruby'],
              correct: 2,
              points: 200,
              penalty: -50
            },
            {
              difficulty: 'Medium',
              question: 'What is the primary purpose of ArcGIS Field Maps?',
              options: ['Creating detailed cartographic layouts', 'Running Python scripts', 'Mobile data collection and field updates', 'Publishing web services'],
              correct: 2,
              points: 200,
              penalty: -50
            },
            {
              difficulty: 'Medium',
              question: 'Which projection is commonly used for web mapping applications like Google Maps?',
              options: ['Web Mercator (EPSG:3857)', 'Robinson', 'Albers Equal Area', 'Geographic WGS84'],
              correct: 0,
              points: 200,
              penalty: -50
            },
            {
              difficulty: 'Medium',
              question: 'What is the purpose of a spatial join in GIS?',
              options: ['To merge attribute tables', 'To combine features based on spatial relationships', 'To create new geometry', 'To change coordinate systems'],
              correct: 1,
              points: 200,
              penalty: -50
            },
            {
              difficulty: 'Hard',
              question: 'Which Python package is essential for ArcGIS Pro scripting and automation?',
              options: ['geopandas', 'arcpy', 'shapely', 'fiona'],
              correct: 1,
              points: 300,
              penalty: -75
            },
            {
              difficulty: 'Hard',
              question: 'What spatial relationship test determines if one feature completely contains another feature?',
              options: ['Intersects', 'Within', 'Contains', 'Touches'],
              correct: 2,
              points: 300,
              penalty: -75
            },
            {
              difficulty: 'Hard',
              question: 'Which geoprocessing tool merges adjacent features with the same attribute values into single features?',
              options: ['Merge', 'Append', 'Dissolve', 'Union'],
              correct: 2,
              points: 300,
              penalty: -75
            },
            {
              difficulty: 'Hard',
              question: 'What is the State Plane Coordinate System optimized for?',
              options: ['Global mapping', 'Accuracy within individual US states', 'Polar regions', 'Ocean navigation'],
              correct: 1,
              points: 300,
              penalty: -75
            },
            {
              difficulty: 'Hard',
              question: 'In ArcGIS Pro, what does the Model Builder tool allow you to do?',
              options: ['Create 3D building models', 'Design and automate geoprocessing workflows', 'Build network datasets', 'Model terrain surfaces'],
              correct: 1,
              points: 300,
              penalty: -75
            },
            {
              difficulty: 'Hard',
              question: 'What is topology in GIS?',
              options: ['A type of map projection', 'Rules that define spatial relationships between features', 'Elevation data format', 'A coordinate system'],
              correct: 1,
              points: 300,
              penalty: -75
            },
            {
              difficulty: 'Hard',
              question: 'Which analysis method would you use to determine the best location for a new facility based on multiple criteria?',
              options: ['Hot Spot Analysis', 'Suitability Analysis', 'Cluster Analysis', 'Trend Analysis'],
              correct: 1,
              points: 300,
              penalty: -75
            },
            {
              difficulty: 'Hard',
              question: 'What is the typical spatial resolution of Landsat 8 multispectral bands?',
              options: ['10 meters', '15 meters', '30 meters', '60 meters'],
              correct: 2,
              points: 300,
              penalty: -75
            },
            {
              difficulty: 'Hard',
              question: 'In utility GIS, what does a geometric network represent?',
              options: ['Survey measurements', 'Connected infrastructure like pipes and wires', 'Satellite imagery', 'Administrative boundaries'],
              correct: 1,
              points: 300,
              penalty: -75
            },
            {
              difficulty: 'Hard',
              question: 'What is the Haversine formula used for in GIS?',
              options: ['Calculating map scale', 'Computing great-circle distance between latitude/longitude points', 'Converting coordinate systems', 'Determining elevation'],
              correct: 1,
              points: 300,
              penalty: -75
            }
          ];

          const lightningQuestions = [
            {
              question: 'Where is Insight Global HQ located?',
              answer: 'Atlanta, GA',
              acceptableAnswers: ['atlanta', 'atlanta ga', 'atlanta, ga', 'atlanta georgia'],
              points: 500
            },
            {
              question: 'Who is the GIS Program Director at Insight Global?',
              answer: 'Justyna Grinholc',
              acceptableAnswers: ['justyna grinholc', 'justyna', 'grinholc'],
              points: 500
            },
            {
              question: 'Where are the other US Evergreen Delivery Centers? (Name all locations)',
              answer: 'Omaha (Nebraska), San Ramon (California), Bellevue (Washington) & Columbus (Ohio)',
              acceptableAnswers: ['omaha san ramon bellevue columbus', 'omaha, san ramon, bellevue, columbus'],
              points: 500,
              hint: 'Nebraska, California, Washington, Ohio'
            },
            {
              question: 'How many members comprise the GIS team under the AES Division at Insight Global?',
              answer: '68',
              acceptableAnswers: ['68', 'sixty-eight', 'sixty eight'],
              points: 500
            }
          ];

          const finalJeopardyQuestion = {
            category: 'Advanced GIS Analysis',
            question: 'This sophisticated spatial analysis technique combines multiple weighted criteria layers to identify optimal locations based on specific requirements, often used in site selection for facilities, conservation planning, and urban development. It typically involves raster overlay analysis with Boolean or fuzzy logic operators. What is this analysis method called?',
            answer: 'Suitability Analysis (or Multi-Criteria Decision Analysis/MCDA)',
            acceptableAnswers: ['suitability analysis', 'suitability', 'multi-criteria decision analysis', 'mcda', 'multi criteria analysis', 'weighted overlay analysis', 'weighted overlay']
          };

          // Check if Firebase is available
          useEffect(() => {
            if (database) {
              setFirebaseMode(true);
              setConnectionError('');
            } else {
              setFirebaseMode(false);
              setConnectionError('Running in local mode - multiplayer disabled. Please check Firebase configuration.');
            }
          }, []);

          // Firebase sync for players
          useEffect(() => {
            if (!database || !roomCode) return;

            playersRef.current = database.ref(`rooms/${roomCode}/players`);
            
            const handlePlayersChange = (snapshot) => {
              const playersData = snapshot.val();
              if (playersData) {
                const playersList = Object.keys(playersData).map(key => ({
                  id: key,
                  ...playersData[key]
                }));
                setPlayers(playersList);
              }
            };

            playersRef.current.on('value', handlePlayersChange);

            return () => {
              if (playersRef.current) {
                playersRef.current.off('value', handlePlayersChange);
              }
            };
          }, [roomCode]);

          // Firebase sync for game state
          useEffect(() => {
            if (!database || !roomCode) return;

            gameStateRef.current = database.ref(`rooms/${roomCode}/gameState`);
            
            const handleGameStateChange = (snapshot) => {
              const state = snapshot.val();
              if (state && !isHost) {
                // Only non-hosts should update from Firebase
                if (state.currentState) setGameState(state.currentState);
                if (state.currentQuestionIndex !== undefined) setCurrentQuestionIndex(state.currentQuestionIndex);
                if (state.showResult !== undefined) setShowResult(state.showResult);
                if (state.lightningQuestionIndex !== undefined) setLightningQuestionIndex(state.lightningQuestionIndex);
                if (state.showJeopardyResult !== undefined) setShowJeopardyResult(state.showJeopardyResult);
              }
            };

            gameStateRef.current.on('value', handleGameStateChange);

            return () => {
              if (gameStateRef.current) {
                gameStateRef.current.off('value', handleGameStateChange);
              }
            };
          }, [roomCode, isHost]);

          // Host updates game state to Firebase
          useEffect(() => {
            if (!database || !roomCode || !isHost) return;

            database.ref(`rooms/${roomCode}/gameState`).set({
              currentState: gameState,
              currentQuestionIndex,
              showResult,
              lightningQuestionIndex,
              showJeopardyResult
            });
          }, [gameState, currentQuestionIndex, showResult, lightningQuestionIndex, showJeopardyResult, roomCode, isHost]);

          const generateRoomCode = () => {
            return Math.random().toString(36).substring(2, 8).toUpperCase();
          };

          const createRoom = async () => {
            if (!firebaseMode) {
              alert('Multiplayer is currently unavailable. Please check your internet connection or Firebase configuration.');
              return;
            }

            const code = generateRoomCode();
            const id = Date.now().toString();
            
            setRoomCode(code);
            setPlayerId(id);
            setIsHost(true);
            
            try {
              await database.ref(`rooms/${code}/players/${id}`).set({
                name: playerName,
                score: 0,
                isHost: true
              });
              
              await database.ref(`rooms/${code}/gameState`).set({
                currentState: 'lobby',
                currentQuestionIndex: 0,
                showResult: false
              });
            } catch (error) {
              console.error('Error creating room:', error);
              alert('Failed to create room. Please try again.');
            }
          };

          const joinRoom = async () => {
            if (!firebaseMode) {
              alert('Multiplayer is currently unavailable. Please check your internet connection or Firebase configuration.');
              return;
            }

            const code = prompt('Enter room code:');
            if (!code) return;
            
            const id = Date.now().toString();
            setPlayerId(id);
            setIsHost(false);
            setRoomCode(code.toUpperCase());
            
            try {
              // Check if room exists
              const roomSnapshot = await database.ref(`rooms/${code.toUpperCase()}`).once('value');
              if (!roomSnapshot.exists()) {
                alert('Room not found! Please check the room code.');
                return;
              }
              
              await database.ref(`rooms/${code.toUpperCase()}/players/${id}`).set({
                name: playerName,
                score: 0,
                isHost: false
              });
            } catch (error) {
              console.error('Error joining room:', error);
              alert('Failed to join room. Please try again.');
            }
          };

          const startGame = () => {
            if (!isHost) return;
            
            setGameState('playing');
            setCurrentQuestionIndex(0);
            setTimeRemaining(30);
            setSelectedAnswer(null);
            setShowResult(false);
            setPlayerAnswers({});
          };

          const updatePlayerScore = async (playerId, scoreChange) => {
            if (!database || !roomCode) return;
            
            try {
              const playerRef = database.ref(`rooms/${roomCode}/players/${playerId}`);
              const snapshot = await playerRef.once('value');
              const currentScore = snapshot.val()?.score || 0;
              await playerRef.update({
                score: Math.max(0, currentScore + scoreChange)
              });
            } catch (error) {
              console.error('Error updating score:', error);
            }
          };

          const selectAnswer = (index) => {
            if (showResult || selectedAnswer !== null) return;
            
            setSelectedAnswer(index);
            const currentQuestion = questions[currentQuestionIndex];
            const isCorrect = index === currentQuestion.correct;
            const points = isCorrect ? currentQuestion.points : currentQuestion.penalty;

            updatePlayerScore(playerId, points);

            setPlayerAnswers(prev => ({
              ...prev,
              [playerId]: { answer: index, correct: isCorrect, points }
            }));

            setShowResult(true);
          };

          // Timer effects
          useEffect(() => {
            if (gameState === 'playing' && !showResult && timeRemaining > 0) {
              const timer = setInterval(() => {
                setTimeRemaining(prev => {
                  if (prev <= 1) {
                    setShowResult(true);
                    return 0;
                  }
                  return prev - 1;
                });
              }, 1000);
              return () => clearInterval(timer);
            }
          }, [gameState, showResult, timeRemaining]);

          useEffect(() => {
            if (gameState === 'lightning' && !showResult && timeRemaining > 0) {
              const timer = setInterval(() => {
                setTimeRemaining(prev => {
                  if (prev <= 1) {
                    setShowResult(true);
                    return 0;
                  }
                  return prev - 1;
                });
              }, 1000);
              return () => clearInterval(timer);
            }
          }, [gameState, showResult, timeRemaining, lightningQuestionIndex]);

          const nextQuestion = () => {
            if (!isHost) return;
            
            if (currentQuestionIndex < questions.length - 1) {
              setCurrentQuestionIndex(prev => prev + 1);
              setTimeRemaining(30);
              setSelectedAnswer(null);
              setShowResult(false);
              setPlayerAnswers({});
              setGameState('playing');
            } else {
              startLightningRound();
            }
          };

          const startLightningRound = () => {
            if (!isHost) return;
            
            setGameState('lightning');
            setLightningQuestionIndex(0);
            setLightningAnswer('');
            setTimeRemaining(10);
            setShowResult(false);
          };

          const submitLightningAnswer = () => {
            const currentLightning = lightningQuestions[lightningQuestionIndex];
            const normalizedAnswer = lightningAnswer.toLowerCase().trim();
            const isCorrect = currentLightning.acceptableAnswers.some(acceptable => 
              normalizedAnswer.includes(acceptable) || acceptable.includes(normalizedAnswer)
            );

            const points = isCorrect ? currentLightning.points : -100;
            updatePlayerScore(playerId, points);

            setShowResult(true);
          };

          const nextLightningQuestion = () => {
            if (!isHost) return;
            
            if (lightningQuestionIndex < lightningQuestions.length - 1) {
              setLightningQuestionIndex(prev => prev + 1);
              setLightningAnswer('');
              setTimeRemaining(10);
              setShowResult(false);
            } else {
              startFinalJeopardy();
            }
          };

          const startFinalJeopardy = () => {
            if (!isHost) return;
            
            setGameState('final-jeopardy');
            setJeopardyWager(0);
            setJeopardyAnswer('');
            setJeopardySubmitted(false);
            setShowJeopardyResult(false);
            setAllJeopardyAnswers({});
          };

          const submitFinalJeopardy = async () => {
            const currentPlayer = players.find(p => p.id === playerId);
            if (!currentPlayer || jeopardyWager > currentPlayer.score || jeopardyWager < 0) {
              alert('Invalid wager! Must be between 0 and your current score.');
              return;
            }

            setJeopardySubmitted(true);
            
            if (database && roomCode) {
              await database.ref(`rooms/${roomCode}/jeopardyAnswers/${playerId}`).set({
                wager: jeopardyWager,
                answer: jeopardyAnswer
              });
            }
          };

          const revealFinalJeopardy = async () => {
            if (!isHost || !database || !roomCode) return;
            
            const answersSnapshot = await database.ref(`rooms/${roomCode}/jeopardyAnswers`).once('value');
            const answers = answersSnapshot.val() || {};
            
            for (const pid of Object.keys(answers)) {
              const playerJeopardy = answers[pid];
              const normalizedAnswer = playerJeopardy.answer.toLowerCase().trim();
              const isCorrect = finalJeopardyQuestion.acceptableAnswers.some(acceptable => 
                normalizedAnswer.includes(acceptable) || acceptable.includes(normalizedAnswer)
              );

              const scoreChange = isCorrect ? playerJeopardy.wager : -playerJeopardy.wager;
              await updatePlayerScore(pid, scoreChange);
              
              await database.ref(`rooms/${roomCode}/players/${pid}`).update({
                jeopardyResult: { correct: isCorrect, wager: playerJeopardy.wager, answer: playerJeopardy.answer }
              });
            }

            setShowJeopardyResult(true);
          };

          const finishGame = () => {
            if (!isHost) return;
            setGameState('finished');
          };

          const showScoreboard = () => {
            if (!isHost) return;
            setGameState('scoreboard');
          };

          const resetGame = async () => {
            if (!isHost || !database || !roomCode) return;
            
            setGameState('lobby');
            setCurrentQuestionIndex(0);
            setLightningQuestionIndex(0);
            setPlayerAnswers({});
            setAllJeopardyAnswers({});
            
            // Reset all player scores in Firebase
            const playersSnapshot = await database.ref(`rooms/${roomCode}/players`).once('value');
            const playersData = playersSnapshot.val();
            
            for (const pid of Object.keys(playersData || {})) {
              await database.ref(`rooms/${roomCode}/players/${pid}`).update({
                score: 0,
                jeopardyResult: null
              });
            }
          };

          const getSortedPlayers = () => {
            return [...players].sort((a, b) => b.score - a.score);
          };

          const currentQuestion = questions[currentQuestionIndex];
          const currentLightning = lightningQuestions[lightningQuestionIndex];

          // CONNECTION ERROR BANNER
          if (connectionError) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-red-900 via-red-800 to-orange-900 p-8 flex items-center justify-center">
                <div className="max-w-2xl mx-auto bg-white rounded-lg shadow-2xl p-8">
                  <div className="text-center mb-6">
                    <AlertCircle className="w-20 h-20 text-red-500 mx-auto mb-4" />
                    <h1 className="text-4xl font-bold text-gray-800 mb-4">Firebase Setup Required</h1>
                    <p className="text-lg text-gray-600 mb-6">{connectionError}</p>
                  </div>
                  
                  <div className="bg-blue-50 rounded-lg p-6 mb-6">
                    <h3 className="font-bold text-lg text-gray-800 mb-3">To enable multiplayer:</h3>
                    <ol className="list-decimal list-inside space-y-2 text-gray-700">
                      <li>Go to <a href="https://console.firebase.google.com" target="_blank" className="text-blue-600 underline">Firebase Console</a></li>
                      <li>Create a new project (free)</li>
                      <li>Enable Realtime Database</li>
                      <li>Copy your configuration</li>
                      <li>Replace the firebaseConfig in the HTML file</li>
                    </ol>
                  </div>
                  
                  <button
                    onClick={() => window.location.reload()}
                    className="w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-3 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-600 transition-all"
                  >
                    Retry Connection
                  </button>
                </div>
              </div>
            );
          }

          // Rest of the game screens remain the same as the previous version
          // LOBBY SCREEN
          if (gameState === 'lobby') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-900 via-purple-900 to-indigo-900 p-8">
                <div className="max-w-4xl mx-auto">
                  <div className="text-center mb-12">
                    <div className="flex items-center justify-center mb-4">
                      <MapPin className="w-16 h-16 text-green-400" />
                    </div>
                    <h1 className="text-6xl font-bold text-white mb-2">GIS Trivia Challenge</h1>
                    <p className="text-2xl text-blue-200">Insight Global ‚Ä¢ Evergreen GIS Team</p>
                    <p className="text-lg text-blue-300 mt-4">30 Questions ‚Ä¢ Lightning Round ‚Ä¢ Final Jeopardy</p>
                    {firebaseMode && (
                      <p className="text-sm text-green-300 mt-2">‚úì Multiplayer Enabled</p>
                    )}
                  </div>

                  <div className="bg-white rounded-lg shadow-2xl p-8 mb-6">
                    <h2 className="text-2xl font-bold text-gray-800 mb-6 text-center">Join the Game</h2>
                    
                    <div className="space-y-4 mb-6">
                      <input
                        type="text"
                        placeholder="Enter your name"
                        value={playerName}
                        onChange={(e) => setPlayerName(e.target.value)}
                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-lg"
                      />
                      
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <button
                          onClick={createRoom}
                          disabled={!playerName.trim()}
                          className="bg-gradient-to-r from-green-500 to-teal-500 text-white px-6 py-3 rounded-lg font-semibold hover:from-green-600 hover:to-teal-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all"
                        >
                          Create Game (Gamemaster)
                        </button>
                        
                        <button
                          onClick={joinRoom}
                          disabled={!playerName.trim()}
                          className="bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-3 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all"
                        >
                          Join Game (Player)
                        </button>
                      </div>
                    </div>

                    {roomCode && (
                      <div className="border-t-2 border-gray-200 pt-6">
                        <div className="bg-blue-50 rounded-lg p-6 mb-4">
                          <p className="text-sm text-gray-600 mb-2">Room Code:</p>
                          <p className="text-3xl font-bold text-blue-600 tracking-wider">{roomCode}</p>
                          <p className="text-sm text-gray-500 mt-2">Share this code with other players</p>
                        </div>

                        <div className="mb-4">
                          <div className="flex items-center mb-3">
                            <Users className="w-5 h-5 text-gray-600 mr-2" />
                            <h3 className="text-lg font-semibold text-gray-700">Players ({players.length})</h3>
                          </div>
                          <div className="space-y-2">
                            {players.map((player, idx) => (
                              <div key={player.id} className="flex items-center bg-gray-50 rounded-lg p-3">
                                <div className="w-8 h-8 bg-gradient-to-br from-blue-400 to-purple-400 rounded-full flex items-center justify-center text-white font-bold mr-3">
                                  {idx + 1}
                                </div>
                                <span className="font-medium text-gray-700">{player.name}</span>
                                {player.id === playerId && (
                                  <span className="ml-2 text-xs bg-blue-500 text-white px-2 py-1 rounded-full">You</span>
                                )}
                                {player.isHost && (
                                  <span className="ml-2 text-xs bg-green-500 text-white px-2 py-1 rounded-full">Host</span>
                                )}
                              </div>
                            ))}
                          </div>
                        </div>

                        {isHost && (
                          <button
                            onClick={startGame}
                            className="w-full bg-gradient-to-r from-orange-500 to-red-500 text-white px-6 py-4 rounded-lg font-bold text-xl hover:from-orange-600 hover:to-red-600 transition-all"
                          >
                            Start Game! üöÄ
                          </button>
                        )}
                      </div>
                    )}
                  </div>

                  <div className="bg-blue-800 bg-opacity-50 rounded-lg p-6 text-white">
                    <h3 className="text-xl font-bold mb-3">Game Format:</h3>
                    <ul className="space-y-2">
                      <li>‚Ä¢ <strong>Round 1:</strong> 30 GIS questions (Easy: 100pts, Medium: 200pts, Hard: 300pts)</li>
                      <li>‚Ä¢ <strong>Penalty System:</strong> Wrong answers deduct points (-25, -50, or -75)</li>
                      <li>‚Ä¢ <strong>Lightning Round:</strong> 4 rapid-fire Insight Global questions (500pts each)</li>
                      <li>‚Ä¢ <strong>Final Jeopardy:</strong> Wager your points on one ultimate GIS question</li>
                      <li>‚Ä¢ <strong>30-second timer</strong> per question (10 seconds for lightning round)</li>
                    </ul>
                  </div>
                </div>
              </div>
            );
          }

          // All other game screens (playing, lightning, final-jeopardy, scoreboard, finished)
          // remain exactly the same as before...
          // For brevity, I'll include just the key playing screen here

          // PLAYING SCREEN  
          if (gameState === 'playing') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-900 via-purple-900 to-indigo-900 p-8">
                <div className="max-w-5xl mx-auto">
                  <div className="bg-white rounded-lg shadow-lg p-4 mb-6">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-6">
                        <div className="flex items-center">
                          <Target className="w-6 h-6 text-blue-600 mr-2" />
                          <span className="text-lg font-bold text-gray-800">
                            Question {currentQuestionIndex + 1} / {questions.length}
                          </span>
                        </div>
                        <div className={`flex items-center px-4 py-2 rounded-lg ${
                          timeRemaining <= 10 ? 'bg-red-100' : 'bg-blue-100'
                        }`}>
                          <Clock className={`w-5 h-5 mr-2 ${
                            timeRemaining <= 10 ? 'text-red-600' : 'text-blue-600'
                          }`} />
                          <span className={`text-xl font-bold ${
                            timeRemaining <= 10 ? 'text-red-600' : 'text-blue-600'
                          }`}>
                            {timeRemaining}s
                          </span>
                        </div>
                      </div>
                      <div className="text-right">
                        <p className="text-sm text-gray-600">Your Score</p>
                        <p className="text-2xl font-bold text-blue-600">
                          {players.find(p => p.id === playerId)?.score || 0}
                        </p>
                      </div>
                    </div>
                  </div>

                  <div className="bg-white rounded-lg shadow-2xl p-8 mb-6">
                    <div className="mb-6">
                      <div className="flex items-center justify-between mb-4">
                        <span className={`px-4 py-2 rounded-full text-sm font-bold ${
                          currentQuestion.difficulty === 'Easy' ? 'bg-green-100 text-green-700' :
                          currentQuestion.difficulty === 'Medium' ? 'bg-yellow-100 text-yellow-700' :
                          'bg-red-100 text-red-700'
                        }`}>
                          {currentQuestion.difficulty} ‚Ä¢ +{currentQuestion.points} / {currentQuestion.penalty}
                        </span>
                        <div className="flex items-center text-sm text-red-600">
                          <AlertTriangle className="w-4 h-4 mr-1" />
                          <span>Wrong answer: {currentQuestion.penalty} points</span>
                        </div>
                      </div>
                      <h2 className="text-2xl font-bold text-gray-800 mb-6">
                        {currentQuestion.question}
                      </h2>
                    </div>

                    <div className="grid grid-cols-1 gap-4">
                      {currentQuestion.options.map((option, index) => {
                        const isSelected = selectedAnswer === index;
                        const isCorrect = index === currentQuestion.correct;
                        const showCorrectAnswer = showResult && isCorrect;
                        const showWrongAnswer = showResult && isSelected && !isCorrect;

                        return (
                          <button
                            key={index}
                            onClick={() => selectAnswer(index)}
                            disabled={showResult || selectedAnswer !== null}
                            className={`p-4 rounded-lg border-2 text-left font-medium transition-all ${
                              showCorrectAnswer
                                ? 'bg-green-100 border-green-500 text-green-800'
                                : showWrongAnswer
                                ? 'bg-red-100 border-red-500 text-red-800'
                                : isSelected
                                ? 'bg-blue-100 border-blue-500 text-blue-800'
                                : 'bg-gray-50 border-gray-300 text-gray-800 hover:bg-gray-100'
                            } ${showResult || selectedAnswer !== null ? 'cursor-not-allowed' : 'cursor-pointer'}`}
                          >
                            <div className="flex items-center justify-between">
                              <span>{option}</span>
                              {showCorrectAnswer && <CheckCircle className="w-6 h-6 text-green-600" />}
                              {showWrongAnswer && <XCircle className="w-6 h-6 text-red-600" />}
                            </div>
                          </button>
                        );
                      })}
                    </div>

                    {showResult && (
                      <div className={`mt-6 p-4 rounded-lg ${
                        selectedAnswer === currentQuestion.correct ? 'bg-green-50' :
                        selectedAnswer === null ? 'bg-gray-50' : 'bg-red-50'
                      }`}>
                        <p className="text-center font-bold text-lg text-gray-800">
                          {selectedAnswer === currentQuestion.correct
                            ? `‚úÖ Correct! +${currentQuestion.points} points`
                            : selectedAnswer === null
                            ? '‚è±Ô∏è Time\'s up! No points awarded'
                            : `‚ùå Incorrect! ${currentQuestion.penalty} points ‚Ä¢ Correct: ${currentQuestion.options[currentQuestion.correct]}`}
                        </p>
                      </div>
                    )}
                  </div>

                  {isHost && showResult && (
                    <div className="grid grid-cols-2 gap-4">
                      <button
                        onClick={showScoreboard}
                        className="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-4 rounded-lg font-bold text-lg hover:from-purple-600 hover:to-pink-600 transition-all"
                      >
                        Show Scoreboard üìä
                      </button>
                      <button
                        onClick={nextQuestion}
                        className="bg-gradient-to-r from-green-500 to-teal-500 text-white px-6 py-4 rounded-lg font-bold text-lg hover:from-green-600 hover:to-teal-600 transition-all"
                      >
                        {currentQuestionIndex < questions.length - 1 ? 'Next Question ‚û°Ô∏è' : 'Lightning Round ‚ö°'}
                      </button>
                    </div>
                  )}
                </div>
              </div>
            );
          }

          // Include all other screens (lightning, final-jeopardy, scoreboard, finished) here
          // They remain the same as before
          return <div>Loading...</div>;
        };

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<GISTriviaChallengeGame />);
    </script>
</body>
</html>
